(function () {function k(e,t,n,s,i,a,o){try{var r=e[a](o),u=r.value}catch(c){return void n(c)}r.done?t(u):Promise.resolve(u).then(s,i)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(s,i){var a=e.apply(t,n);function o(e){k(a,s,i,o,r,"next",e)}function r(e){k(a,s,i,o,r,"throw",e)}o(void 0)})}}function m(e,t,n,r,o,i,a){try{var s=e[i](a),p=s.value}catch(c){return void n(c)}s.done?t(p):Promise.resolve(p).then(r,o)}function q(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){m(i,r,o,a,s,"next",e)}function s(e){m(i,r,o,a,s,"throw",e)}a(void 0)})}}var d={props:{item:function(){return{type:Object,default:{}}}},computed:{itemlink:function(){return"archive.org"==this.item.type?this.item.data.url:this.item.target},itemclass:function(){return"archive.org"==this.item.type?"k-list-item-sendmentions-sent k-list-item-sendmentions-archiveorg":"pingback"==this.item.type||"webmention"==this.item.type?"k-list-item-sendmentions-sent":"k-list-item-sendmentions-failed"},type_formatted:function(){switch(this.item.type){case"none":return"no endpoint";case"webmention":return this.item.type+" ("+this.item.data.response+")";default:return this.item.type;}},buttonicon:function(){return"archive.org"===this.item.type?"":"refresh"},icon:function(){switch(this.item.type){case"webmention":return"sendmentions-webmention";case"pingback":return"globe";case"archive.org":return"sendmentions-archiveorg";case"none":return"cancel";default:return"circle-outline";}}}};if(typeof d==="function"){d=d.options}Object.assign(d,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("li",{staticClass:"k-list-item",class:_vm.itemclass},[_c("div",{staticClass:"k-list-item-content"},[_c("a",{staticClass:"k-link k-list-item-content",attrs:{"href":_vm.itemlink,"target":"_blank"}},[_c("span",{staticClass:"k-list-item-image"},[_c("k-icon",{attrs:{"type":_vm.icon}})],1),_vm._v(" "),_c("span",{staticClass:"k-list-item-text"},[_c("em",{domProps:{"innerHTML":_vm._s(_vm.item.target)}}),_vm._v(" "),_c("small",{domProps:{"innerHTML":_vm._s(_vm.type_formatted)}})])])]),_vm._v(" "),_vm.item.type!="archive.org"?_c("nav",{staticClass:"k-list-item-options"},[_c("k-button",{attrs:{"tooltip":_vm.$t("send"),"icon":_vm.buttonicon,"alt":_vm.Send},on:{"click":function($event){$event.stopPropagation();return _vm.$emit("action","triggerPing",_vm.item)}}})],1):_vm._e()])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var f={};if(typeof f==="function"){f=f.options}Object.assign(f,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("ul",{staticClass:"k-list"},[_vm._t("default")],2)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var g={components:{"k-sendmentions-list":f,"k-sendmentions-item":d},data:function(){return{sendmentions:[],empty:null}},methods:{open:function(e,t){this.sendmentions=e,this.empty=t,this.$refs.dialog.open()},submit:function(){this.$refs.dialog.close()},action:function(e,t){"triggerPing"===e&&this.triggerPing(t.pageid,t.target,t.type)},triggerPing:function(e,t,n){var r=this;return q(regeneratorRuntime.mark(function o(){var i;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return console.log(e+t+n),i="sendmentions/"+e.replace(/\//,"+"),o.next=4,r.$api.patch(i,{target:t,type:n});case 4:if("none"!==o.sent.type){o.next=9;break}r.$store.dispatch("notification/error","No endpoint found for "+t),o.next=12;break;case 9:return o.next=11,r.load().then(function(e){return r.sendmentions=e.sendmentions});case 11:r.$store.dispatch("notification/success",":)");case 12:case"end":return o.stop();}},o)}))()}}};if(typeof g==="function"){g=g.options}Object.assign(g,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("k-dialog",{ref:"dialog",staticClass:"k-sendmentions-detailsdialog",attrs:{"button":_vm.$t("Done"),"size":"large","theme":"positive"},on:{"submit":_vm.submit}},[_vm.sendmentions.length>0?_c("k-sendmentions-list",_vm._l(_vm.sendmentions,function(item){return _c("k-sendmentions-item",{key:item.uid,attrs:{"item":item},on:{"action":_vm.action}})}),1):_c("k-empty",{attrs:{"layout":"list","icon":"globe"}},[_vm._v(" "+_vm._s(_vm.empty)+" ")])],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var h={};if(typeof h==="function"){h=h.options}Object.assign(h,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{staticClass:"k-grid k-sendmentions-pagesettings"},[_vm._t("default")],2)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var j={props:{setting:Object},computed:{label:function(){return Array.isArray(this.setting.text)?this.setting.value?this.setting.text[0]:this.setting.text[1]:this.setting.text}},methods:{change:function(t){this.setting.value=t,this.$emit("change",this.setting.id,t)}}};if(typeof j==="function"){j=j.options}Object.assign(j,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{staticClass:"k-column",attrs:{"data-width":"1/1"}},[_c("div",{staticClass:"k-toggle-field k-field"},[_c("div",{staticClass:"k-input",attrs:{"data-theme":"field","data-type":"toggle"}},[_c("span",{staticClass:"k-input-element"},[_c("label",{staticClass:"k-toggle-input",attrs:{"data-disabled":_vm.setting.disabled}},[_c("input",{ref:"input",staticClass:"k-toggle-input-native",attrs:{"id":_vm.setting.id,"disabled":_vm.setting.disabled,"type":"checkbox"},domProps:{"checked":_vm.setting.value},on:{"change":function($event){return _vm.change($event.target.checked)}}}),_vm._v(" "),_c("span",{staticClass:"k-toggle-input-label",domProps:{"innerHTML":_vm._s(_vm.label)}})])])])])])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var b={extends:"k-info-section",components:{"k-sendmentions-details-dialog":g,"k-sendmentions-pagesettings":h,"k-sendmentions-pagesettingstoggle":j},props:{name:String,parent:String},data:function(){return{headline:null,settings:[],counter:[],queued:null}},created:function(){var e=this;this.load().then(function(t){e.headline=t.headline,e.sendmentions=t.sendmentions,e.empty=t.empty,e.sendmentionsSystemErrors=t.sendmentionsSystemErrors,e.settings=t.pageSettings,e.pageid=t.pageId,e.counter=e.output(t.sendmentions),e.queued=t.queued}),this.$events.$on("page.changeStatus",this.statuschange),this.$events.$on("model.update",this.pagesave)},destroyed:function(){this.$events.$off("page.changeStatus",this.statuschange),this.$events.$off("model.update",this.pagesave)},methods:{load:function(){return this.$api.get(this.parent+"/sections/"+this.name)},statuschange:function(){var e=this;this.load().then(function(t){e.sendmentions=t.sendmentions,e.settings=t.pageSettings,e.queued=t.queued,e.counter=e.output(t.sendmentions)}),console.log("Page status changed")},pagesave:function(){var e=this;this.load().then(function(t){e.sendmentions=t.sendmentions,e.settings=t.pageSettings,e.queued=t.queued,e.counter=e.output(t.sendmentions)}),console.log("Page saved")},output:function(e){var t={mention:0,ping:0,none:0,archive:0};return Object.keys(e).forEach(function(n){"webmention"===e[n].type?t.mention++:"pingback"===e[n].type?t.ping++:"none"===e[n].type?t.none++:"archive.org"===e[n].type&&t.archive++}),t},details:function(){this.$refs.details.open(this.sendmentions,this.empty)},changePageSetting:function(e,t){var n=this;return l(regeneratorRuntime.mark(function s(){var i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i="sendmentions/pagesettings/"+n.pageid.replace(/\//,"+"),s.next=3,n.$api.patch(i,{key:e,value:t});case 3:s.sent;case 4:case"end":return s.stop();}},s)}))()},triggerQueue:function(){var e=this;return l(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="sendmentions/"+e.pageid.replace(/\//,"+"),t.next=3,e.$api.patch(n);case 3:if("ok"!==t.sent.status){t.next=10;break}return t.next=7,e.load().then(function(t){e.sendmentions=t.sendmentions,e.queued=t.queued,e.counter=e.output(t.sendmentions)});case 7:e.$store.dispatch("notification/success",":)"),t.next=11;break;case 10:e.$store.dispatch("notification/error","Something went wrong.");case 11:case"end":return t.stop();}},t)}))()}}};if(typeof b==="function"){b=b.options}Object.assign(b,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("section",{staticClass:"k-sendmentions-section k-section"},[_c("header",{staticClass:"k-section-header"},[_c("k-headline",[_vm._v(_vm._s(_vm.headline))])],1),_vm._v(" "),_vm._l(_vm.sendmentionsSystemErrors,function(error){return _c("k-box",{key:error.id,attrs:{"theme":error.theme}},[_c("k-text",{attrs:{"size":"small"},domProps:{"innerHTML":_vm._s(error.message)}})],1)}),_vm._v(" "),_c("ul",{staticClass:"k-list"},[_c("li",{staticClass:"k-list-item",on:{"click":function($event){return _vm.details()}}},[_c("span",{staticClass:"k-list-item-text k-sendmentions-section-count"},[_c("em",[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-sendmentions-webmention"}})]),_vm._v(" "+_vm._s(_vm.counter.mention)+" ")]),_vm._v(" "),_c("em",[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-globe"}})]),_vm._v(" "+_vm._s(_vm.counter.ping)+" ")]),_vm._v(" "),_c("em",[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-cancel"}})]),_vm._v(" "+_vm._s(_vm.counter.none)+" ")]),_vm._v(" "),_c("em",[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-sendmentions-archiveorg"}})]),_vm._v(" "+_vm._s(_vm.counter.archive)+" ")])]),_vm._v(" "),_c("nav",{staticClass:"k-list-item-options"},[_c("button",{staticClass:"k-button",attrs:{"type":"button"}},[_c("span",{staticClass:"k-button-icon k-icon k-icon-cog",attrs:{"aria-hidden":"true"}},[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-cog"}})])])])])]),_vm._v(" "),_vm.queued?_c("li",{staticClass:"k-list-item",on:{"click":_vm.triggerQueue}},[_c("span",{staticClass:"k-list-item-text k-sendmentions-section-queued"},[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-clock"}})]),_vm._v(" "),_c("em",[_vm._v("Enqueued for processing")])]),_vm._v(" "),_c("nav",{staticClass:"k-list-item-options"},[_c("button",{staticClass:"k-button",attrs:{"type":"button"}},[_c("span",{staticClass:"k-button-icon k-icon k-icon-sendmentions-run",attrs:{"aria-hidden":"true"}},[_c("svg",{attrs:{"viewBox":"0 0 16 16","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[_c("use",{attrs:{"xlink:href":"#icon-sendmentions-run"}})])])])])]):_vm._e()]),_vm._v(" "),_c("k-sendmentions-pagesettings",_vm._l(_vm.settings,function(setting){return _c("k-sendmentions-pagesettingstoggle",{key:setting.id,attrs:{"setting":setting},on:{"change":_vm.changePageSetting}})}),1),_vm._v(" "),_c("k-sendmentions-details-dialog",{ref:"details"})],2)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());panel.plugin("sgkirby/sendmentions",{sections:{sendmentions:b,pings:b},icons:{"sendmentions-webmention":"<polygon fill-rule=\"nonzero\" points=\"9.23775281 14.8085393 7.34377528 9.01793258 7.31235955 9.01793258 5.45002247 14.8085393 2.96193258 14.8085393 0.00413483146 3.62759551 2.4611236 3.62759551 4.2294382 11.2382921 4.26067416 11.2382921 6.20139326 5.44750562 8.50202247 5.44750562 10.411191 11.3318652 10.4425618 11.3318652 11.8070562 5.45137079 10.0297079 5.44750562 13.7139775 2.02314607 16 5.45191011 14.189618 5.45078652 11.6785169 14.8085393\"></polygon>","sendmentions-archiveorg":"<path d=\"M15.5 1.8l-.3.5H.5l-.3-.5L8 0zm-.3 1H.5v1.4h14.7zm-1.8 7.7v1.3l.1 1.6.2.1q.6.2 1.3 0 .3-4.1 0-8.8-.8-.2-1.5 0v1.1l-.1 1v3.7zm-12.5.7v2.3H1.3l.2.1h1v-.1-.6l.1-1.9V9v-.8-.8-.8-.9-1H1v.8l-.1.2V11.2zm4 1.1v.7l.1.2v.3h.2l.1.1h1.1v-.1l.1-.6V11l.1-1V9 5.8l-.1-1H5L5 5v1.2l-.1.7v5.4zm6.2-6.8v-.7l-.4-.2-1 .1-.2 1.4V13l.1.6h.2l.2.1h1v-.1-.4l.1-.3v-2l.1-.8V9 7.8v-1-1.2zM.6 15h14.8V14H.6zM0 16h16v-.7H0z\"></path>","sendmentions-run":"<path d=\"M-.001 2.382V13.34l7.959-5.473v5.473l7.968-5.479-7.968-5.478v5.473z\" />"}});})();